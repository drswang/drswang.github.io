<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SWx Lab</title>
    <!-- Load MathJax script -->
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <!-- Load BibTeX-js script -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bibtex-js/1.0.6/bibtex.min.js"></script>
</head>
<body>
    <h1>SWx Lab</h1>
    <h2>Publications (updated to <span id="currentDate"></span>)</h2>

    <!-- Your TeX content will be rendered here -->
    <div id="content">
        Insert your TeX content here, and use \cite{Tian2023,Li2023,Wang2022c,Wang2022b,Wang2022a} to cite references.
    </div>
<script type="text/javascript">
    // Function to get the current date in the format: YYYY-MM-DD
    function getCurrentDate() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // Update the "updated to date" with the current date
    const currentDateElement = document.getElementById('currentDate');
    currentDateElement.textContent = getCurrentDate();

    // Load the BibTeX file
    const xhr = new XMLHttpRequest();
    xhr.open('GET', 'references.bib');
    xhr.onreadystatechange = function () {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                // Parse the BibTeX data
                const bibtexData = xhr.responseText;
                const bibliography = new BibtexParser().parse(bibtexData);

                // Attach the bibliography to the references
                const contentElement = document.getElementById('content');
                contentElement.innerHTML += '<h2>References</h2>';
                bibliography.entries$.forEach(entry => {
                    const key = entry.key;
                    const author = entry.entryTags.author;
                    const title = entry.entryTags.title;
                    const journal = entry.entryTags.journal;
                    const year = entry.entryTags.year;
                    const pages = entry.entryTags.pages;

                    const reference = document.createElement('p');
                    reference.innerHTML = `${author}. (${year}). ${title}. ${journal}, ${pages}.`;
                    contentElement.appendChild(reference);
                });

                // Rerender TeX with MathJax to show citations properly
                MathJax.Hub.Queue(['Typeset', MathJax.Hub, contentElement]);
            } else {
                console.error('Failed to load BibTeX file.');
            }
        }
    };
    xhr.send();
</script>

</body>
</html>
